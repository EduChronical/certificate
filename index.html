import matplotlib.pyplot as plt
import matplotlib.patches as patches

# 1. Setup the Figure according to A4 dimensions (in inches)
# A4 is approx 8.27 x 11.69 inches.
fig, ax = plt.subplots(figsize=(8.27, 11.69), dpi=300)

# 2. Define Margins (IPO Rule: Top/Left 4cm, Right/Bottom 3cm)
# Converting cm to relative figure coordinates (approximate for display)
plt.subplots_adjust(left=0.15, right=0.9, top=0.9, bottom=0.1)

# 3. Draw Pavement Layers (Cross-Section)
# Layer 1: Sub-grade (Soil) - Bottom
subgrade = patches.Rectangle((0, 0), 10, 2, linewidth=1.5, edgecolor='black', facecolor='white', hatch='...')
ax.add_patch(subgrade)

# Layer 2: Granular Sub-base - Middle
subbase = patches.Rectangle((0, 2), 10, 1.5, linewidth=1.5, edgecolor='black', facecolor='white', hatch='ooo')
ax.add_patch(subbase)

# Layer 3: Dense Bituminous Macadam (DBM) - Top Base
dbm = patches.Rectangle((0, 3.5), 10, 1.5, linewidth=1.5, edgecolor='black', facecolor='white', hatch='///')
ax.add_patch(dbm)

# Layer 4: Bituminous Concrete (BC) with Nanosilica - Surface Course
bc_layer = patches.Rectangle((0, 5), 10, 1.2, linewidth=1.5, edgecolor='black', facecolor='white', hatch='xx')
ax.add_patch(bc_layer)

# 4. Draw Vascular Network (Module C)
# Draw hollow tubes embedded in the BC/DBM interface
tube_positions = [1, 2, 3, 4]
for x_pos in tube_positions:
    # Outer Tube Wall
    tube = patches.Circle((x_pos, 5.0), 0.25, linewidth=1.5, edgecolor='black', facecolor='white')
    ax.add_patch(tube)
    # Inner Hollow Channel
    inner_tube = patches.Circle((x_pos, 5.0), 0.15, linewidth=1.0, edgecolor='black', facecolor='black') # Filled black to show fluid
    ax.add_patch(inner_tube)

# 5. Draw Schematic Crack and Healing Action
# Draw a jagged line representing a crack
crack_x = [4.0, 4.1, 3.9, 4.0]
crack_y = [6.2, 5.8, 5.4, 5.0] # Cracking from surface down to the tube
ax.plot(crack_x, crack_y, color='black', linewidth=1.5, linestyle='--')

# 6. Add Reference Numerals (No Text labels allowed on drawing)
def add_ref(x, y, text):
    ax.text(x, y, text, fontsize=12, fontweight='bold', ha='center', va='center', 
            bbox=dict(facecolor='white', edgecolor='none', pad=1))

# Arrows and Numbers
ax.annotate('104', xy=(1, 5.6), xytext=(0.5, 6.5), arrowprops=dict(facecolor='black', arrowstyle='->')) # BC Layer
ax.annotate('103', xy=(1, 4.0), xytext=(0.5, 4.0), arrowprops=dict(facecolor='black', arrowstyle='->')) # DBM Layer
ax.annotate('102', xy=(1, 2.7), xytext=(0.5, 2.7), arrowprops=dict(facecolor='black', arrowstyle='->')) # Sub-base
ax.annotate('101', xy=(1, 1.0), xytext=(0.5, 1.0), arrowprops=dict(facecolor='black', arrowstyle='->')) # Sub-grade
ax.annotate('105', xy=(6, 5.0), xytext=(6, 6.5), arrowprops=dict(facecolor='black', arrowstyle='->'))   # Vascular Tube
ax.annotate('106', xy=(4, 5.8), xytext=(4.5, 7.0), arrowprops=dict(facecolor='black', arrowstyle='->')) # Crack (Healed)

# 7. Formatting
ax.set_xlim(-1, 11)
ax.set_ylim(-1, 8)
ax.set_aspect('equal')
ax.axis('off') # Turn off chart axes

# Figure Label
plt.text(5, -0.5, "Figure 1", fontsize=14, fontweight='bold', ha='center')

plt.title("Applicant: [User Name]   Sheet 1 of 4", fontsize=10, loc='right', y=0.98)
plt.show()
